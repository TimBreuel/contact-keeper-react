{"ast":null,"code":"import _regeneratorRuntime from\"/Users/timbreuel/Desktop/contact-keeper/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/timbreuel/Desktop/contact-keeper/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/timbreuel/Desktop/contact-keeper/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from\"react\";import axios from\"axios\";import AuthContext from\"./AuthContext\";import AuthReducer from\"./AuthReducer\";import setAuthToken from\"../../utils/setAuthToken\";import{REGISTER_SUCCESS,REGISTER_FAILED,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from\"../type\";var AuthState=function AuthState(props){////////\n//STATE\nvar initalState={token:localStorage.getItem(\"token\"),isAuthenticated:null,user:null,loading:true,error:null};var _useReducer=useReducer(AuthReducer,initalState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];///////////////////////////////////////////////////////////////\n///////////////////////////METHODS/////////////////////////////\n///////////\n//LOAD USER\nvar loadUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// console.log(\"localState:\", localStorage.token);\n// console.log(\"initalState:\", initalState.token);\nif(localStorage.token){setAuthToken(localStorage.token);}_context.prev=1;_context.next=4;return axios.get(\"/api/auth\");case 4:res=_context.sent;// console.log(\"res:\", res);\ndispatch({type:USER_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);// console.log(\"resError:\", error);\ndispatch({type:AUTH_ERROR});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadUser(){return _ref.apply(this,arguments);};}();////////////////\n//REGISTER USER\nvar registerUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData){var config,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context2.prev=1;_context2.next=4;return axios.post(\"api/users\",formData,config);case 4:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);dispatch({type:REGISTER_FAILED,payload:_context2.t0.response.data.msg});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function registerUser(_x){return _ref2.apply(this,arguments);};}();/////////////\n//LOGIN USER\nvar loginUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context3.prev=1;_context3.next=4;return axios.post(\"api/auth\",formData,config);case 4:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});loadUser();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function loginUser(_x2){return _ref3.apply(this,arguments);};}();/////////////\n//LOGOUT USER\nvar logoutUser=function logoutUser(){dispatch({type:LOGOUT});};//////////////\n//CLEAR ERRORS\nvar clearErrors=function clearErrors(){dispatch({type:CLEAR_ERRORS});};/////////////////////////////\n//RETURN PROVIDER AND VALUES\nreturn/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,user:state.user,loading:state.loading,error:state.error,registerUser:registerUser,loadUser:loadUser,loginUser:loginUser,logoutUser:logoutUser,clearErrors:clearErrors}},props.children);};export default AuthState;","map":{"version":3,"sources":["/Users/timbreuel/Desktop/contact-keeper/client/src/context/auth/AuthState.js"],"names":["React","useReducer","axios","AuthContext","AuthReducer","setAuthToken","REGISTER_SUCCESS","REGISTER_FAILED","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","AuthState","props","initalState","token","localStorage","getItem","isAuthenticated","user","loading","error","state","dispatch","loadUser","get","res","type","payload","data","registerUser","formData","config","headers","post","response","msg","loginUser","logoutUser","clearErrors","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from \"react\";\nimport axios from \"axios\";\nimport AuthContext from \"./AuthContext\";\nimport AuthReducer from \"./AuthReducer\";\nimport setAuthToken from \"../../utils/setAuthToken\";\nimport {\n  REGISTER_SUCCESS,\n  REGISTER_FAILED,\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGOUT,\n  CLEAR_ERRORS,\n} from \"../type\";\n\nconst AuthState = (props) => {\n  ////////\n  //STATE\n  const initalState = {\n    token: localStorage.getItem(\"token\"),\n    isAuthenticated: null,\n    user: null,\n    loading: true,\n    error: null,\n  };\n\n  const [state, dispatch] = useReducer(AuthReducer, initalState);\n  ///////////////////////////////////////////////////////////////\n  ///////////////////////////METHODS/////////////////////////////\n\n  ///////////\n  //LOAD USER\n  const loadUser = async () => {\n    // console.log(\"localState:\", localStorage.token);\n    // console.log(\"initalState:\", initalState.token);\n    if (localStorage.token) {\n      setAuthToken(localStorage.token);\n    }\n    try {\n      const res = await axios.get(\"/api/auth\");\n      // console.log(\"res:\", res);\n      dispatch({ type: USER_LOADED, payload: res.data });\n    } catch (error) {\n      // console.log(\"resError:\", error);\n      dispatch({ type: AUTH_ERROR });\n    }\n  };\n  ////////////////\n  //REGISTER USER\n  const registerUser = async (formData) => {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    };\n    try {\n      const res = await axios.post(\"api/users\", formData, config);\n      dispatch({\n        type: REGISTER_SUCCESS,\n        payload: res.data,\n      });\n      loadUser();\n    } catch (error) {\n      dispatch({\n        type: REGISTER_FAILED,\n        payload: error.response.data.msg,\n      });\n    }\n  };\n\n  /////////////\n  //LOGIN USER\n  const loginUser = async (formData) => {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    };\n    try {\n      const res = await axios.post(\"api/auth\", formData, config);\n      dispatch({\n        type: LOGIN_SUCCESS,\n        payload: res.data,\n      });\n      loadUser();\n    } catch (error) {\n      dispatch({\n        type: LOGIN_FAIL,\n        payload: error.response.data.msg,\n      });\n    }\n  };\n  /////////////\n  //LOGOUT USER\n  const logoutUser = () => {\n    dispatch({ type: LOGOUT });\n  };\n  //////////////\n  //CLEAR ERRORS\n  const clearErrors = () => {\n    dispatch({ type: CLEAR_ERRORS });\n  };\n\n  /////////////////////////////\n  //RETURN PROVIDER AND VALUES\n  return (\n    <AuthContext.Provider\n      value={{\n        token: state.token,\n        isAuthenticated: state.isAuthenticated,\n        user: state.user,\n        loading: state.loading,\n        error: state.error,\n        registerUser,\n        loadUser,\n        loginUser,\n        logoutUser,\n        clearErrors,\n      }}\n    >\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthState;\n"]},"metadata":{},"sourceType":"module"}